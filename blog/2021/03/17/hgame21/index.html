
<!DOCTYPE html>
<html lang="zh-CN ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BraveTroops || hgame21</title>
    <meta name="author" content="御史神风">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/blog//blog/imgs/child.jpg">
    <link rel="stylesheet" href="/blog/css/antd.min.css">
    
    <link rel="stylesheet" href="/blog/css/maiden-theme.css">
    
    <script src="/blog/js/vue.js"></script>
    <script src="/blog/js/antd.min.js"></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/blog/rss2.xml" title="BraveTroops" type="application/rss+xml">
</head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/blog/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/blog/">
            <span class="title">BraveTroops</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/contact.html">
            <span>
                <a-icon type="idcard" theme="filled" />
            </span>
            <span>about</span>
        </a>
        
        <a href="/making">
            <span>
                <a-icon type="folder" theme="filled" />
            </span>
            <span>archives</span>
        </a>
        
        <a href="/blog/categories">
            <span>
                <a-icon type="book" theme="filled" />
            </span>
            <span>categories</span>
        </a>
        
        <a href="/blog/tags">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>BraveTroops</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/contact.html">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="idcard" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">about</div>
                </div>
            </a>
            
            <a href="/making">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="folder" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="book" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/blog/css/post-body.css">
<div class="article">
    <div>
        <h1>hgame21 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2021/3/17
        </span>

        
        <span class="category">
            <a href="/blog/categories/CTF">
                <span class="icon">
                    <a-icon type="book" theme="filled" />
                </span>
                CTF
            </a>
        </span>
        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/ctf" style=color:#ff7d73>
                    ctf
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/wp" style=color:#ffa2c4>
                    wp
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/re" style=color:#879cff>
                    re
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/pwn" style=color:#879cff>
                    pwn
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/misc" style=color:#1bccbc>
                    misc
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/web" style=color:#879cff>
                    web
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h1 id="web-week1"><a href="#web-week1" class="headerlink" title="web week1"></a>web week1</h1><h2 id="智商检测鸡（150）"><a href="#智商检测鸡（150）" class="headerlink" title="智商检测鸡（150）"></a>智商检测鸡（150）</h2><p>我用的python requests+beautifulsoup。</p>
<p>这题是通过cookie当作账号，做出一题就会给出下一个cookie。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">getQ = <span class="string">&#x27;http://r4u.top:5000/api/getQuestion&#x27;</span></span><br><span class="line">getS = <span class="string">&#x27;http://r4u.top:5000/api/getStatus&#x27;</span></span><br><span class="line">submit = <span class="string">&#x27;http://r4u.top:5000/api/verify&#x27;</span></span><br><span class="line">getF = <span class="string">&#x27;http://r4u.top:5000/api/getFlag&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.get(url=getQ)</span><br><span class="line">header = &#123;<span class="string">&#x27;Cookie&#x27;</span>: res.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> c/<span class="number">2</span>*x*x + d*x</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="comment"># 获取</span></span><br><span class="line">    res = requests.get(url=getQ, headers=header)</span><br><span class="line">    bs = BeautifulSoup(res.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    a = <span class="built_in">int</span>(bs.msubsup.contents[<span class="number">1</span>].mn.text)</span><br><span class="line">    <span class="keyword">if</span>(bs.msubsup.contents[<span class="number">1</span>].mo != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(bs.msubsup.contents[<span class="number">1</span>].mo.text == <span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">            a = -a</span><br><span class="line">    b = <span class="built_in">int</span>(bs.msubsup.contents[<span class="number">2</span>].mn.text)</span><br><span class="line">    <span class="keyword">if</span>(bs.msubsup.contents[<span class="number">2</span>].mo != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(bs.msubsup.contents[<span class="number">2</span>].mo.text == <span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">            b = -b</span><br><span class="line">    c = <span class="built_in">int</span>(bs.mrow.contents[<span class="number">2</span>].text)</span><br><span class="line">    d = <span class="built_in">int</span>(bs.mrow.contents[<span class="number">5</span>].text)</span><br><span class="line">    <span class="comment"># 计算</span></span><br><span class="line">    ans = <span class="built_in">round</span>(f(b)-f(a), <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 返回</span></span><br><span class="line">    res2 = requests.post(url=submit, headers=header, json=&#123;<span class="string">&#x27;answer&#x27;</span>:ans&#125;)</span><br><span class="line">    print(res2.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>])</span><br><span class="line">    header = &#123;<span class="string">&#x27;Cookie&#x27;</span>: res2.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>]&#125;</span><br><span class="line">    <span class="comment"># 检查</span></span><br><span class="line">    res = requests.get(url=getS, headers=header)</span><br><span class="line">    print(res.text)</span><br><span class="line"></span><br><span class="line">res = requests.get(url=getF, headers=header)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<h1 id="misc-week1"><a href="#misc-week1" class="headerlink" title="misc week1"></a>misc week1</h1><h2 id="Base全家福（50）"><a href="#Base全家福（50）" class="headerlink" title="Base全家福（50）"></a>Base全家福（50）</h2><p>base64+base32+base16</p>
<h1 id="pwn-week1"><a href="#pwn-week1" class="headerlink" title="pwn week1"></a>pwn week1</h1><h2 id="whitegive（50）"><a href="#whitegive（50）" class="headerlink" title="whitegive（50）"></a>whitegive（50）</h2><p>if(num == “paSsw0rd”)</p>
<p>ida中找到if语句中的字符串地址即可。</p>
<h1 id="re-week1"><a href="#re-week1" class="headerlink" title="re week1"></a>re week1</h1><h2 id="apacha（150）"><a href="#apacha（150）" class="headerlink" title="apacha（150）"></a>apacha（150）</h2><p>一个比较复杂的推理。需要注意的是，变量要用unsigned int。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> new_a1[<span class="number">35</span>] = &#123;&#125;; <span class="comment">// dump</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">6</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> l, r;</span><br><span class="line"></span><br><span class="line">    v6 = v6s[i];</span><br><span class="line">    v7 = v6 &gt;&gt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后一个</span></span><br><span class="line">    v5 = new_a1[a2 - <span class="number">2</span>];</span><br><span class="line">    result = (v5 * <span class="number">16</span>) ^ (new_a1[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line">    l = (a3[((a2 - <span class="number">1</span>) ^ (<span class="keyword">unsigned</span> __int8)v7) &amp; <span class="number">3</span>] ^ v5) + (new_a1[<span class="number">0</span>] ^ v6);</span><br><span class="line">    r = ((<span class="number">4</span> * new_a1[<span class="number">0</span>]) ^ (v5 &gt;&gt; <span class="number">5</span>)) + result;</span><br><span class="line">    old_a1[a2 - <span class="number">1</span>] = new_a1[a2 - <span class="number">1</span>] - (l ^ r);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = a2 - <span class="number">2</span>; j &gt;= <span class="number">0</span>; j--) &#123; <span class="comment">// j = v8</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            v5 = new_a1[j - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            v5 = old_a1[a2 - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        l = ((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * old_a1[j + <span class="number">1</span>])) + ((<span class="number">16</span> * v5) ^ (old_a1[j + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>));</span><br><span class="line">        r = (a3[(((<span class="keyword">unsigned</span> __int8)j ^ (<span class="keyword">unsigned</span> __int8)v7) &amp; <span class="number">3</span>)] ^ v5) + ((old_a1[j + <span class="number">1</span>]) ^ (v6));</span><br><span class="line">        f = l ^ r;</span><br><span class="line">        old_a1[j] = new_a1[j] - f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">35</span>; j++)</span><br><span class="line">        new_a1[j] = old_a1[j];</span><br></pre></td></tr></table></figure>

<h2 id="hellowRe（150）"><a href="#hellowRe（150）" class="headerlink" title="hellowRe（150）"></a>hellowRe（150）</h2><p>一个异或。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x97</span>, <span class="number">0x99</span>, <span class="number">0x9C</span>, <span class="number">0x91</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0x91</span>, <span class="number">0x9D</span>, <span class="number">0x9B</span>, <span class="number">0x9A</span>, <span class="number">0x9A</span>,<span class="number">0xAB</span>, <span class="number">0x81</span>, <span class="number">0x97</span>, <span class="number">0x0AE</span>, <span class="number">0x80</span>, <span class="number">0x83</span>, <span class="number">0x8F</span>, <span class="number">0x94</span>, <span class="number">0x89</span>, <span class="number">0x99</span>,<span class="number">0x97</span>, <span class="number">0x0</span>, <span class="number">0x0</span>]</span><br><span class="line"></span><br><span class="line">b = <span class="number">0xff</span></span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    c.append(a[i] ^ b)</span><br><span class="line">    b -= <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="pypy（150）"><a href="#pypy（150）" class="headerlink" title="pypy（150）"></a>pypy（150）</h2><p>python字节码转python代码。一个交换和异或。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x30466633346f59213b4139794520572b45514d61583151576638643a</span></span><br><span class="line">cipher = long_to_bytes(flag)</span><br><span class="line">length = <span class="built_in">len</span>(cipher)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">    cipher = <span class="built_in">list</span>(x)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length//<span class="number">2</span>):</span><br><span class="line">        cipher[i*<span class="number">2</span>], cipher[<span class="number">2</span>*i+<span class="number">1</span>] = cipher[i*<span class="number">2</span>+<span class="number">1</span>], cipher[<span class="number">2</span>*i]</span><br><span class="line"></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        res.append(cipher[i] ^ i)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re</span>(<span class="params">cipher</span>):</span></span><br><span class="line">    res = <span class="built_in">list</span>(cipher)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        res[i] ^= i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length//<span class="number">2</span>):</span><br><span class="line">        res[i*<span class="number">2</span>], res[<span class="number">2</span>*i+<span class="number">1</span>] = res[i*<span class="number">2</span>+<span class="number">1</span>], res[<span class="number">2</span>*i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line"></span><br><span class="line">print(re(flag))</span><br></pre></td></tr></table></figure>

<h1 id="re-week2"><a href="#re-week2" class="headerlink" title="re week2"></a>re week2</h1><h2 id="ezApk"><a href="#ezApk" class="headerlink" title="ezApk"></a>ezApk</h2><p>找到位置后，看不太懂，是aes cbc加密。</p>
<h2 id="helloRe2"><a href="#helloRe2" class="headerlink" title="helloRe2"></a>helloRe2</h2><h3 id="sse2指令"><a href="#sse2指令" class="headerlink" title="sse2指令"></a>sse2指令</h3><p>sse2指令集是个扩展指令集。cpp中需要include &lt;emmintrin.h&gt;。</p>
<p>_mm_load_si128：加载128bits值，vs中试了以下相当于把字符串直接转数字。</p>
<p>_mm_cmpeq_epi8：判断是否相等</p>
<p>_mm_movemask_epi8：没查</p>
<h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p>cmp(load(flag1), flag)</p>
<p>ida中flag = 0x981b02a3a6e5c0b2</p>
<p>所以flag1(input)是”2b0c5e6a3a20b189”</p>
<h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>flag1正确后会异或一次然后重启程序，接着进入输入flag2的分支。</p>
<p>BCrypt解密没看懂。后面补了AES的CBC和ECB才看懂。</p>
<h3 id="复现主函数及BCrypt-h的使用"><a href="#复现主函数及BCrypt-h的使用" class="headerlink" title="复现主函数及BCrypt.h的使用"></a>复现主函数及BCrypt.h的使用</h3><p>要先include windows.h再include BCrypt.h</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/seccng/cng-algorithm-identifiers">https://docs.microsoft.com/en-us/windows/win32/seccng/cng-algorithm-identifiers</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">NTSTATUS <span class="title">BCryptGenerateSymmetricKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  BCRYPT_ALG_HANDLE hAlgorithm,  <span class="comment">// handle of algorithm</span></span></span></span><br><span class="line"><span class="function"><span class="params">  BCRYPT_KEY_HANDLE *phKey,      <span class="comment">// recive handle of key</span></span></span></span><br><span class="line"><span class="function"><span class="params">  PUCHAR            pbKeyObject, <span class="comment">// recive key object</span></span></span></span><br><span class="line"><span class="function"><span class="params">  ULONG             cbKeyObject, <span class="comment">// sizeof(pbKeyObject)</span></span></span></span><br><span class="line"><span class="function"><span class="params">  PUCHAR            pbSecret,    <span class="comment">// pt a key witch to creat key</span></span></span></span><br><span class="line"><span class="function"><span class="params">  ULONG             cbSecret,    <span class="comment">// sizeof(pbSecret)</span></span></span></span><br><span class="line"><span class="function"><span class="params">  ULONG             dwFlags</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>找到关键的参数如下。c实际上有32位，这里只得到16位，上网找脚本破解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">0x32</span>, <span class="number">0x63</span>, <span class="number">0x32</span>, <span class="number">0x60</span>, <span class="number">0x31</span>, <span class="number">0x60</span>, <span class="number">0x30</span>, <span class="number">0x66</span>, <span class="number">0x3b</span>, <span class="number">0x68</span>, <span class="number">0x38</span>, <span class="number">0x3b</span>, <span class="number">0x6e</span>, <span class="number">0x3c</span>, <span class="number">0x36</span>, <span class="number">0x36</span>]</span><br><span class="line"><span class="comment"># 32633260316030663b68383b6e3c3636</span></span><br><span class="line">iv = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0xa</span>, <span class="number">0xb</span>, <span class="number">0xc</span>, <span class="number">0xd</span> ,<span class="number">0xe</span> ,<span class="number">0xf</span>]</span><br><span class="line"><span class="comment"># 000102030405060708090a0b0c0d0e0f</span></span><br><span class="line">c = [<span class="number">0xB7</span>, <span class="number">0xFE</span>, <span class="number">0xFE</span>, <span class="number">0xD9</span>, <span class="number">7</span>, <span class="number">0x76</span>, <span class="number">0x79</span>, <span class="number">0x65</span>, <span class="number">0x3F</span>, <span class="number">0x4E</span>, <span class="number">0x5F</span>, <span class="number">0x62</span>, <span class="number">0xD5</span>, <span class="number">2</span>, <span class="number">0xF6</span>, <span class="number">0x7E</span>]</span><br><span class="line"><span class="comment"># b7fefed9077679653f4e5f62d502f67e</span></span><br><span class="line">m = <span class="string">&#x27;7a4ad6c5671fb313&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;hgame&#123;2b0c5e6a3a20b189</span></span><br><span class="line"><span class="string">_7a4ad6c5671fb313&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>复现了一下他的代码。这里解密失败了，不知道是什么原因。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">BCRYPT_HANDLE name;</span><br><span class="line">DWORD objLen = <span class="number">0</span>, blockLength = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> btw = <span class="number">0</span>, nts = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">wchar_t</span> mode[<span class="number">16</span>] = <span class="string">L&quot;ChainingModeCBC&quot;</span>;</span><br><span class="line">BCRYPT_KEY_HANDLE hKey;</span><br><span class="line">UCHAR pKey[<span class="number">618</span>] = &#123; <span class="number">0</span> &#125;, pbSecret[<span class="number">16</span>] = &#123; <span class="number">0x32</span>, <span class="number">0x63</span>, <span class="number">0x32</span>, <span class="number">0x60</span>, <span class="number">0x31</span>, <span class="number">0x60</span>, <span class="number">0x30</span>, <span class="number">0x66</span>, <span class="number">0x3b</span>, <span class="number">0x68</span>, <span class="number">0x38</span>, <span class="number">0x3b</span>, <span class="number">0x6e</span>, <span class="number">0x3c</span>, <span class="number">0x36</span>, <span class="number">0x36</span> &#125;, pKeyBLOB[<span class="number">560</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">UCHAR pIV[<span class="number">16</span>] = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0xa</span>, <span class="number">0xb</span>, <span class="number">0xc</span>, <span class="number">0xd</span>, <span class="number">0xe</span>, <span class="number">0xf</span> &#125;;</span><br><span class="line"></span><br><span class="line">name = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">__try &#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    nts = BCryptOpenAlgorithmProvider(&amp;name, <span class="string">L&quot;AES&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((nts &lt; <span class="number">0</span>) || name == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; nts &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        __leave;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取属性值</span></span><br><span class="line">    nts = BCryptGetProperty(name, <span class="string">L&quot;ObjectLength&quot;</span>, (PUCHAR)&amp;objLen, <span class="number">4</span>, &amp;btw, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ObjectLength(&quot;</span> &lt;&lt; btw &lt;&lt; <span class="string">&quot;): &quot;</span> &lt;&lt; objLen &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 618</span></span><br><span class="line"></span><br><span class="line">    nts = BCryptGetProperty(name, <span class="string">L&quot;BlockLength&quot;</span>, (PUCHAR)&amp;blockLength, <span class="number">4</span>, &amp;btw, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;BlockLength(&quot;</span> &lt;&lt; btw &lt;&lt; <span class="string">&quot;): &quot;</span> &lt;&lt; blockLength &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 16</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (blockLength &lt;= <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置模式为CBC</span></span><br><span class="line">        nts = BCryptSetProperty(name, <span class="string">L&quot;ChainingMode&quot;</span>, (PUCHAR)mode, <span class="number">0x20</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成密钥对象</span></span><br><span class="line">        nts = BCryptGenerateSymmetricKey(name, &amp;hKey, pKey, objLen, pbSecret, <span class="number">16</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取key BLOB长度</span></span><br><span class="line">        /nts = BCryptExportKey(hKey, <span class="number">0</span>, <span class="string">L&quot;OpaqueKeyBlob&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;btw, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;keyBLOBLen: &quot;</span> &lt;&lt; btw &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 560</span></span><br><span class="line">        <span class="comment">// 接收key BLOB</span></span><br><span class="line">        nts = BCryptExportKey(hKey, <span class="number">0</span>, <span class="string">L&quot;OpaqueKeyBlob&quot;</span>, pKeyBLOB, <span class="number">560</span>, &amp;btw, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取密文长度</span></span><br><span class="line">        nts = BCryptEncrypt(hKey, inputs, <span class="number">16</span>, <span class="number">0</span>, pIV, <span class="number">16</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;btw, BCRYPT_BLOCK_PADDING);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ciphertextLen: &quot;</span> &lt;&lt; btw &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 32</span></span><br><span class="line">        <span class="comment">// 加密</span></span><br><span class="line">        nts = BCryptEncrypt(hKey, inputs, <span class="number">16</span>, <span class="number">0</span>, pIV, <span class="number">16</span>, c, <span class="number">32</span>, &amp;btw, BCRYPT_BLOCK_PADDING);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解密</span></span><br><span class="line">        nts = BCryptDecrypt(hKey, c, <span class="number">32</span>, <span class="number">0</span>, pIV, <span class="number">16</span>, m, <span class="number">16</span>, &amp;btw, BCRYPT_BLOCK_PADDING);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; btw &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; m &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">__finally &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2016 - 2021 BraveTroops
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @御史神风
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div>
        
    </div>

</footer>

<script src="/blog/js/highlight.min.js"></script>
<script src="/blog/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'windgodm',
        admin: ['windgodm'],
        language: 'zh-CN',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>